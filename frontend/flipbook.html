<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flipbook Viewer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stpageflip@2.0.7/dist/page-flip.browser.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/stpageflip@2.0.7/dist/page-flip.browser.min.css">
  <style>
    body { display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
    #flipbook { width: 80%; height: 90%; }
  </style>
</head>
<body>
  <div id="flipbook"></div>

 <script>
const flipbook = document.getElementById("flipbook");
let pageFlip;

// Fetch uploaded PDFs
async function fetchPDFs() {
  const res = await fetch("/files");
  const pdfs = await res.json();

  // If no PDFs, show message
  if (!pdfs.length) {
    flipbook.innerHTML = "<p>No PDFs uploaded yet.</p>";
    return;
  }

  // Create a list of links
  const list = document.createElement("ul");
  pdfs.forEach(url => {
    const li = document.createElement("li");
    const a = document.createElement("a");
    a.href = "#";
    a.textContent = url.split("/").pop();
    a.onclick = () => loadPDF(url);
    li.appendChild(a);
    list.appendChild(li);
  });

  flipbook.innerHTML = "";
  flipbook.appendChild(list);
}

// Load a PDF into the flipbook
async function loadPDF(url) {
  const pdf = await pdfjsLib.getDocument(url).promise;
  flipbook.innerHTML = ""; // clear previous content

  pageFlip = new St.PageFlip(flipbook, {
    width: 600,
    height: 800,
    size: "stretch",
    drawShadow: true,
    showCover: true
  });

  for (let i = 1; i <= pdf.numPages; i++) {
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({ scale: 1.5 });
    const canvas = document.createElement("canvas");
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    const ctx = canvas.getContext("2d");
    await page.render({ canvasContext: ctx, viewport }).promise;

    pageFlip.loadFromHTML([
      { type: "image", src: canvas.toDataURL(), width: 600, height: 800 }
    ]);
  }
}

// Initialize
fetchPDFs();
</script>
</body>
</html>

